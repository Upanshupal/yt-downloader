<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>YouTube Video Downloader</title>
  <style>
    /* full styling (same as your design) */
    *{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI, Tahoma, Geneva, Verdana, sans-serif}
    body{background:linear-gradient(135deg,#1a2a6c,#b21f1f,#fdbb2d);min-height:100vh;padding:20px;display:flex;flex-direction:column;align-items:center;color:#fff}
    .container{width:100%;max-width:800px;background:rgba(0,0,0,0.7);border-radius:15px;padding:30px;box-shadow:0 10px 30px rgba(0,0,0,0.5);margin-top:20px}
    header{text-align:center;margin-bottom:30px}
    h1{font-size:2.5rem;margin-bottom:10px;background:linear-gradient(to right,#ff8a00,#da1b60);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .description{color:#ddd;margin-bottom:20px;font-size:1.1rem}
    .input-group{display:flex;margin-bottom:25px}
    input{flex:1;padding:15px;border:none;border-radius:5px 0 0 5px;font-size:1rem;background:#333;color:white}
    button{padding:15px 25px;border:none;border-radius:0 5px 5px 0;background:#ff4757;color:white;font-weight:bold;cursor:pointer;transition:background .3s}
    button:hover{background:#ff6b81}
    .video-info{display:none;margin-top:20px;animation:fadeIn .5s}
    .video-container{display:flex;margin-bottom:20px;background:#222;border-radius:10px;overflow:hidden}
    .thumbnail{width:40%;min-width:200px}
    .thumbnail img{width:100%;height:auto;display:block}
    .details{padding:15px;width:60%}
    .details h3{margin-bottom:10px;color:#ffd700}
    .details p{margin-bottom:8px;color:#ccc}
    .formats{margin-top:20px}
    .formats h3{margin-bottom:15px;color:#ffd700}
    .format-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px}
    .format-btn{background:#3742fa;padding:12px;border-radius:5px;text-align:center;cursor:pointer;transition:transform .2s,background .2s}
    .format-btn:hover{background:#5352ed;transform:translateY(-2px)}
    .loader{display:none;text-align:center;margin:20px 0}
    .loader-spinner{border:5px solid #f3f3f3;border-top:5px solid #ff4757;border-radius:50%;width:50px;height:50px;animation:spin 1s linear infinite;margin:0 auto}
    .error{display:none;color:#ff6b81;background:rgba(255,107,129,.1);padding:15px;border-radius:5px;margin-top:20px;text-align:center}
    .disclaimer{margin-top:30px;text-align:center;font-size:.9rem;color:#aaa;padding:15px;background:rgba(0,0,0,.3);border-radius:8px}
    footer{margin-top:30px;text-align:center;color:#ddd;font-size:.9rem}
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    @media(max-width:768px){.video-container{flex-direction:column}.thumbnail,.details{width:100%}.format-grid{grid-template-columns:1fr 1fr}}
    @media(max-width:480px){.format-grid{grid-template-columns:1fr}.input-group{flex-direction:column}input{border-radius:5px;margin-bottom:10px}button{border-radius:5px}}
  </style>
</head>
<body>
  <header>
    <h1>YouTube Video Downloader</h1>
    <p class="description">Download your favourite YouTube videos in different formats</p>
  </header>

  <div class="container">
    <div class="input-group">
      <input type="text" id="youtube-url" placeholder="Paste YouTube URL (watch / youtu.be / shorts)" />
      <button id="fetch-btn">Fetch Video</button>
    </div>

    <div class="loader" id="loader"><div class="loader-spinner"></div><p style="text-align:center">Fetching video information...</p></div>
    <div class="error" id="error"></div>

    <div class="video-info" id="video-info">
      <div class="video-container">
        <div class="thumbnail"><img id="thumbnail" src="" alt="Video thumbnail" /></div>
        <div class="details">
          <h3 id="video-title"></h3>
          <p id="video-uploader"></p>
          <p id="video-duration"></p>
        </div>
      </div>

      <div class="formats">
        <h3>Available Formats</h3>
        <div class="format-grid" id="format-grid"></div>
      </div>
    </div>

    <div class="disclaimer"><strong>Disclaimer:</strong> For personal/educational use only. Respect copyright & YouTube Terms of Service.</div>
  </div>

  <footer><p>YouTube Video Downloader • Demo</p></footer>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const fetchBtn = document.getElementById("fetch-btn");
      const youtubeUrlInput = document.getElementById("youtube-url");
      const loader = document.getElementById("loader");
      const errorDiv = document.getElementById("error");
      const videoInfo = document.getElementById("video-info");
      const videoTitle = document.getElementById("video-title");
      const videoUploader = document.getElementById("video-uploader");
      const videoDuration = document.getElementById("video-duration");
      const thumbnail = document.getElementById("thumbnail");
      const formatGrid = document.getElementById("format-grid");

      // ✅ Backend deployed on Render
      const API_BASE_URL = "https://yt-downloader-5.onrender.com";

      fetchBtn.addEventListener("click", fetchVideoInfo);
      youtubeUrlInput.addEventListener("keypress", (e) => { if (e.key === "Enter") fetchVideoInfo(); });

      function showLoader(on = true) { loader.style.display = on ? "block" : "none"; }
      function showError(msg) { errorDiv.textContent = msg; errorDiv.style.display = "block"; videoInfo.style.display = "none"; showLoader(false); }
      function clearError() { errorDiv.style.display = "none"; }

      function isValidYouTubeUrl(url) {
        const re = /^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.?be)\/.+$/;
        return re.test(url);
      }

      function secondsToHMS(sec) {
        if (!sec && sec !== 0) return "";
        const m = Math.floor(sec / 60), s = sec % 60;
        return `${m}:${s < 10 ? "0" : ""}${s}`;
      }

      async function fetchVideoInfo() {
        clearError();
        const url = youtubeUrlInput.value.trim();
        if (!url) { showError("Please enter a YouTube URL"); return; }
        if (!isValidYouTubeUrl(url)) { showError("Please enter a valid YouTube URL"); return; }

        showLoader(true);
        try {
          const resp = await fetch(`${API_BASE_URL}/api/videoinfo?url=${encodeURIComponent(url)}`);
          if (!resp.ok) {
            const err = await resp.json().catch(()=>({error: "Network Error"}));
            throw new Error(err.error || "Failed to fetch");
          }
          const data = await resp.json();
          if (data.error) throw new Error(data.error);

          // fill info
          videoTitle.textContent = data.title || "Untitled";
          videoUploader.textContent = `Uploader: ${data.uploader || "Unknown"}`;
          videoDuration.textContent = `Duration: ${secondsToHMS(data.duration)}`;
          thumbnail.src = data.thumbnail || "";
          thumbnail.alt = data.title || "";

          // formats
          formatGrid.innerHTML = "";
          (data.formats || []).forEach(fmt => {
            const btn = document.createElement("div");
            btn.className = "format-btn";
            const sizeMB = fmt.filesize ? (fmt.filesize / (1024 * 1024)).toFixed(2) + " MB" : "Unknown size";
            let quality = fmt.height ? (fmt.height + "p") : (fmt.format_note || (fmt.ext || "").toUpperCase());
            btn.innerHTML = `<strong>${quality}</strong><div>${(fmt.ext||"").toUpperCase()}</div><div>${sizeMB}</div>`;
            btn.onclick = () => {
              const downloadUrl = `${API_BASE_URL}/api/download?url=${encodeURIComponent(url)}&format_id=${encodeURIComponent(fmt.format_id||"best")}`;
              window.open(downloadUrl, "_blank");
            };
            formatGrid.appendChild(btn);
          });

          videoInfo.style.display = "block";
        } catch (err) {
          showError("Error: " + (err.message || err));
        } finally {
          showLoader(false);
        }
      }
    });
  </script>
</body>
</html>
